
<ion-header class="ion-no-border">
  <!-- <ion-toolbar *ngIf="!longPressActive" class="ion-padding" style="padding-bottom: 0px;"> -->
  <ion-toolbar class="ion-padding" style="padding-bottom: 0px;">
    <ion-label>
      <h2 style="font-weight: bold;">Mis</h2>
      <h1 style="font-weight: bold;">Clientes</h1>
    </ion-label>
    <ion-icon style="font-size: 24px;" color="dark" slot="end" name="notifications-outline"></ion-icon>
    <ion-item slot="end" lines="none">
      <ion-avatar slot="end" (click)="openModal()">
        <ion-img src="https://ionicframework.com/docs/img/demos/avatar.svg"></ion-img>
      </ion-avatar>
    </ion-item>
  </ion-toolbar>
  <!-- <ion-toolbar *ngIf="longPressActive" color="darkmain" style="padding: 0px 10px; z-index: 10000;">
    <ion-icon slot="start" (click)="cancelAllSelections()" slot="start" style="font-size: 26px; --ionicon-stroke-width: 38px;" name="arrow-back"></ion-icon>
    <ion-label>
      <h2 style="font-weight: bold; margin-left: 5px;"> {{selectedClientesNoAsignados.length}}</h2>
    </ion-label>
    <ion-icon slot="end" style="font-size: 26px; --ionicon-stroke-width: 38px; margin: 0px 8px;" name="trash-outline" (click)="eliminarClienteNoAsig()"></ion-icon>
    <ion-icon slot="end" style="font-size: 26px; --ionicon-stroke-width: 38px; margin: 0px 8px;" name="person-add-outline" (click)="setOpenLongPress(true)"></ion-icon>
    <ion-icon slot="end" style="font-size: 26px; --ionicon-stroke-width: 38px; margin: 0px 8px;" name="ellipsis-vertical" id="left-start"></ion-icon>
    <ion-popover trigger="left-start" side="left" alignment="start" [showBackdrop]="false" [dismissOnSelect]="true">
      <ng-template>
        <ion-content class="">
          <ion-list>
            <ion-item [button]="true" [detail]="false" lines="none" (click)="viewClienteNoAsig()" *ngIf="selectedClientesNoAsignados.length==1">Informacion del cliente</ion-item>
            <ion-item [button]="true" [detail]="false" lines="none" (click)="edithClienteNoAsig()" *ngIf="selectedClientesNoAsignados.length==1">Editar usuario</ion-item>
            <ion-item [button]="true" [detail]="false" lines="none" (click)="setOpenLongPress(true)">Asignar asesor</ion-item>
            <ion-item [button]="true" [detail]="false" lines="none" (click)="eliminarClienteNoAsig()">Eliminar</ion-item>
          </ion-list>
        </ion-content>
      </ng-template>
    </ion-popover>
  </ion-toolbar> -->
</ion-header>

<ion-item *ngIf="longPressActive" color="darkmain">
  <ion-icon slot="start" (click)="cancelAllSelections()" slot="start"
    style="font-size: 26px; --ionicon-stroke-width: 38px;" name="arrow-back"></ion-icon>
  <ion-label>
    <h2 style="font-weight: bold; margin-left: 5px;"> {{selectedClientesNoAsignados.length}}</h2>
  </ion-label>
  <ion-icon slot="end" style="font-size: 26px; --ionicon-stroke-width: 38px; margin: 0px 8px;" name="trash-outline" (click)="eliminarClienteNoAsig()"></ion-icon>
  <ion-icon slot="end" style="font-size: 26px; --ionicon-stroke-width: 38px; margin: 0px 8px;" name="person-add-outline" (click)="setOpenLongPress(true)"></ion-icon>
  <ion-icon slot="end" style="font-size: 26px; --ionicon-stroke-width: 38px; margin: 0px 8px;" name="ellipsis-vertical" id="left-start"></ion-icon>
  <ion-popover trigger="left-start" side="left" alignment="start" [showBackdrop]="false" [dismissOnSelect]="true">
    <ng-template>
      <ion-content class="">
        <ion-list>
          <ion-item [button]="true" [detail]="false" lines="none" (click)="viewClienteNoAsig()"
            *ngIf="selectedClientesNoAsignados.length==1">Informacion del cliente</ion-item>
          <ion-item [button]="true" [detail]="false" lines="none" (click)="edithClienteNoAsig()"
            *ngIf="selectedClientesNoAsignados.length==1">Editar usuario</ion-item>
          <ion-item [button]="true" [detail]="false" lines="none" (click)="setOpenLongPress(true)">Asignar
            asesor</ion-item>
          <ion-item [button]="true" [detail]="false" lines="none" (click)="eliminarClienteNoAsig()">Eliminar</ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-popover>
</ion-item>

<ion-content class="ion-padding">
  <!-- <ion-row>
    <ion-col size="7" style="align-items: left; justify-content: left; color: black;">
      <h5 style="font-size: 16px; font-weight: bold;">Mis</h5>
      <h2 style="font-size: 22px; font-weight: bold; margin: 0;">Clientes</h2>
    </ion-col>
    <ion-col size="5">
      <ion-item lines="none">
        <ion-avatar slot="end" (click)="openModal()">
          <ion-img src="https://i.pravatar.cc/300?u=c"></ion-img>
        </ion-avatar>
        <ion-label style="padding-left: 10px; color: black;">
          <ion-icon style="font-size: 24px;" name="notifications-outline"></ion-icon>
        </ion-label>
      </ion-item>
    </ion-col>
  </ion-row> -->

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-searchbar *ngIf="dataUser.role === 'ADMINISTRADOR' && !longPressActive" placeholder="Buscar por nombre, telefono, etc..." class="custom ion-no-padding" (ionInput)="handleInput($event)"></ion-searchbar>
  <ion-searchbar *ngIf="dataUser.role === 'ASESOR' && !longPressActive" placeholder="Buscar por nombre, telefono, etc..." class="custom ion-no-padding" (ionInput)="handleInputClientes($event)"></ion-searchbar>

  <h5 style="font-size: 14px; font-weight: bold;" *ngIf="clientesNoAsignados.length>0">Clientes denegados o sin asesor ({{clientesNoAsignados.length}})</h5>


  <!-- <ion-list class="ion-no-padding" style="margin: 6px; border-radius: 10px;" [inset]="true">
    <ion-item [button]="true" [detail]="false" [color]="selectedAsesores.length == 0? 'light' : 'darkmain'">
      <ion-icon name="woman-outline" *ngIf="selectedAsesores.length == 0" slot="start"></ion-icon>
      <ion-icon name="close-circle" *ngIf="selectedAsesores.length > 0" slot="start"
        (click)="removeAseSelection()"></ion-icon>
      <ion-label style="font-size: 14px;">Asesor</ion-label>
      <div id="select-asesores" slot="end" style="color: #CACACA;font-size: 14px;font-weight: bold;">
        {{selectedAsesoresText}}</div>
      <ion-icon *ngIf="selectedAsesores.length > 0" slot="end" name="checkmark-outline"></ion-icon>
    </ion-item>
  </ion-list> -->
  <ion-modal [isOpen]="modalAsesores">
    <ng-template>
      <app-cliente-modal
        class="ion-page"
        title="MIS ASESORES"
        [items]="asesores"
        [selectedItems]="selectedAsesores"
        (selectionChange)="asesorSelectionChanged($event)"
        (selectionCancel)="modalAsesores=false">
      </app-cliente-modal>
    </ng-template>
  </ion-modal>
  <ion-modal [isOpen]="asignarAsesorModal"
    [canDismiss]="!asesorParaAsignar"
    [initialBreakpoint]="1"
    [breakpoints]="[0, 1]"
    (ionModalWillDismiss)="removeAseSelection()"
    style="--height: auto;">
    <ng-template>
      <div class="block-asesor">
        <div style="display: flex; align-items: center;" *ngIf="asesorParaAsignar&&selectedClientesNoAsignados.length>0">
          <ion-avatar style="height: 60px; width: 60px;" *ngIf="srcImageName(asesorParaAsignar?.evidencia_aval,'foto-perfil') as image">
            <img alt="Silhouette of a person's head" [src]="image.url" />
          </ion-avatar>
          <ion-icon name="chevron-forward-outline"></ion-icon>
          <ng-container *ngFor="let cliente of selectedClientesNoAsignados.slice(0,3)">
            <ion-avatar style="height: 48px; width: 48px; margin: 0 4px;"
              *ngIf="srcImageName(cliente.evidencia_aval,'foto-perfil') as image">
              <img alt="Cliente" [src]="image.url" />
            </ion-avatar>
          </ng-container>
          <h2 *ngIf="selectedClientesNoAsignados.length>3">+{{selectedClientesNoAsignados.length - 3}}</h2>
        </div>

        <ion-text><h3>{{selectedClientesNoAsignados.length>1? 'Asignar asesora a clientes' : 'Asignar asesora a cliente' }}</h3></ion-text>
        <p style="text-align: center;">
          <ion-text color="medium">
            {{
              selectedClientesNoAsignados.length>1?
              'Al aceptar y continuar transferiras estos clientes a al asesor selecionado. Podras cambiar esto cuando quieras.'
              :
              'Al aceptar y continuar transferiras este cliente a al asesor selecionado. Podras cambiar esto cuando quieras.'
            }}
          </ion-text>
          <!-- <ion-text color="primary" (click)="removeAseSelection()"> Cancelar</ion-text> -->
        </p>
        <ion-button color="darkmain" *ngIf="selectedAsesores.length == 0" fill="clear" (click)="modalAsesores=true">Elegir asesor</ion-button>
        <ion-button color="darkmain" *ngIf="canContinueAsignarAsesor()" shape="round" (click)="asignarAsesorAMultiplesClientes()">Continuar</ion-button>
        <ion-button color="darkmain" fill="clear" size="small" (click)="removeAseSelection()">Cancelar</ion-button>
      </div>
    </ng-template>
  </ion-modal>


  <!-- <ion-item
    #noAsigItem
    *ngFor="let cliente of clientesNoAsignados.slice(0,3); let i = index"
    [button]="true"
    [detail]="false"
    [ngClass]="{'long-pressed': longPressedId === cliente._id}"
    (click)="onItemClick(cliente._id, cliente)">
    <div style="position: relative;">
      <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" *ngIf="srcImageName(cliente.evidencia_aval, 'foto-perfil') as image"
        [src]="image?.url" />
      </ion-avatar>
      <ion-icon *ngIf="longPressedId === cliente._id" color="success" style="position: absolute; bottom: 1px; right: 2px; font-size: 18px;" name="checkmark-circle"></ion-icon>
    </div>
    <ion-label style="margin: 0px;">
      <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">{{cliente.nombre}}</h5>
      <p style=" margin-bottom: 0px; font-size: 11px;"><ion-text [color]="longPressedId === cliente._id? 'light':'medim'">{{cliente.email}}</ion-text></p>
    </ion-label>
    <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
      Saldo: <span style="color: #BD2121;">{{cliente.saldo_asignado==0?'Sin saldo': cliente.saldo_asignado}}</span>
    </ion-label>
  </ion-item> -->
  <ion-item
    #noAsigItem
    *ngFor="let cliente of clientesNoAsignados.slice(0,3); let i = index"
    [button]="true"
    [detail]="false"
    [ngClass]="{'long-pressed': isClienteSeleccionado(cliente)}"
    (click)="onItemClick(cliente._id, cliente)">
    <div style="position: relative;">
      <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" *ngIf="srcImageName(cliente.evidencia_aval, 'foto-perfil') as image"
        [src]="image?.url" />
      </ion-avatar>
      <ion-icon *ngIf="isClienteSeleccionado(cliente)" color="success" style="position: absolute; bottom: 1px; right: 2px; font-size: 18px;" name="checkmark-circle"></ion-icon>
    </div>
    <ion-label style="margin: 0px;">
      <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">{{cliente.nombre}}</h5>
      <p style=" margin-bottom: 0px; font-size: 11px;"><ion-text [color]="isClienteSeleccionado(cliente)? 'light':'medim'">{{cliente.email}}</ion-text></p>
    </ion-label>
    <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
      Saldo: <span style="color: #BD2121;">{{cliente.saldo_asignado==0?'Sin saldo': cliente.saldo_asignado}}</span>
    </ion-label>
  </ion-item>
  <div *ngIf="showMore">
    <ion-item
      #noAsigItem
      *ngFor="let cliente of clientesNoAsignados.slice(3)"
      [button]="true"
      [ngClass]="{'long-pressed': isClienteSeleccionado(cliente)}"
      (click)="onItemClick(cliente._id, cliente)">
      <div style="position: relative;">
        <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
          <img alt="Silhouette of a person's head" *ngIf="srcImageName(cliente.evidencia_aval, 'foto-perfil') as image"
          [src]="image?.url" />
        </ion-avatar>
        <ion-icon *ngIf="isClienteSeleccionado(cliente)" color="success" style="position: absolute; bottom: 1px; right: 2px; font-size: 18px;" name="checkmark-circle"></ion-icon>
      </div>
      <ion-label style="margin: 0px;">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">{{cliente.nombre}}</h5>
        <p style=" margin-bottom: 0px; font-size: 11px;"><ion-text [color]="isClienteSeleccionado(cliente)? 'light':'medim'">{{cliente.email}}</ion-text></p>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
        Saldo: <span style="color: #BD2121;">{{cliente.saldo_asignado==0?'Sin saldo': cliente.saldo_asignado}}</span>
      </ion-label>
    </ion-item>
  </div>

  <h5
    *ngIf="clientesNoAsignados.length>3"
    (click)="toggleShowMore()"
    style="color: gray; text-align: center; font-size: 14px; font-weight: bold; margin: 16px 0px;"
    >
    {{ showMore ? 'Mostrar menos' : 'Mostrar más' }}
  </h5>

  <h5 style="font-size: 14px; font-weight: bold; margin: 30px 0px 20px;">Listado de clientes</h5>

  <ng-container *ngIf="dataUser.role === 'ADMINISTRADOR'">
    <ion-item-group *ngFor="let asesor of results" >
      <ion-item-divider class="head-list">
        <!-- <div class="ion-no-padding" style="display: flex; align-items: center; justify-content: space-between;">
          <div style="padding: 5px;"><img [src]="asesor.foto_perfil" referrerpolicy="no-referrer" class="image" width="42px" height="42px" /></div>
          <div class="">
            <h5 style="margin: 0px 8px; font-size: 14px;"><strong>{{asesor.nombre}}</strong></h5>
          </div>
        </div> -->
        <ion-item class="ion-no-padding" lines="none">
          <ion-avatar slot="start" style="--border-radius: 20%;">
            <img [src]="asesor.foto_perfil" referrerpolicy="no-referrer" width="42px" height="42px" />
          </ion-avatar>
          <ion-label style="font-weight: bold;">{{asesor.nombre}}</ion-label>
        </ion-item>
      </ion-item-divider>
  
      <section *ngFor="let cliente of asesor.clientes; let i = index; let last = last">
        <ion-item lines="none" class="card-item">
          <ion-avatar slot="start" style="margin: 1px 8px 1px 0px;" class="item-avatar" (click)="setOpenClient(true, cliente)">
            <img *ngIf="srcImageName(cliente.evidencia_aval, 'foto-perfil') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="Cliente image"  />
          </ion-avatar>
          <ion-label style="margin: 0px;" (click)="setOpenClient(true, cliente)">
            <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">{{cliente.nombre}}</h5>
          </ion-label>
          <ion-label style="font-size: 11px; text-align: center; font-weight: bold;" (click)="setOpenClient(true, cliente)">
            Saldo: <span style="color: #14BD4D;">${{cliente.saldo}}.00</span>
          </ion-label>
          <ion-icon style="margin: 0px;" name="ellipsis-vertical" slot="end" (click)="setOpenOpts(true, cliente)"></ion-icon>
        </ion-item>
        <div *ngIf="!last" class="" style="display: flex; justify-content: center; text-align: center; width: 100%; margin-left: 16px;"><ion-icon name="ellipsis-vertical" color="medium" style="font-size: 14px;"></ion-icon></div>
      </section>
  
    </ion-item-group>
  </ng-container>
  <ng-container *ngIf="dataUser.role === 'ASESOR'">
    <ion-item lines="none" *ngFor="let cliente of results" style="margin: 10px 0px;">
      <ion-avatar slot="start" (click)="setOpenClient(true, cliente)">
        <img *ngIf="srcImageName(cliente.evidencia_aval, 'foto-perfil') as image"
          [src]="image.url" alt="Cliente image" />
      </ion-avatar>
      <ion-label (click)="setOpenClient(true, cliente)">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">{{cliente.nombre}}</h5>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;" (click)="setOpenClient(true, cliente)">
        Saldo: <span style="color: #14BD4D;">${{cliente.saldo}}.00</span>
      </ion-label>
      <ion-icon style="margin: 0px;" name="ellipsis-vertical" slot="end" (click)="setOpenOpts(true, cliente)"></ion-icon>
    </ion-item>
  </ng-container>

  <!-- <ion-item-group>
    <ion-item-divider class="head-list">
      <div class="ion-no-padding" style="display: flex; align-items: center; justify-content: space-between;">
        <div style="padding: 5px;"><img src="https://i.pravatar.cc/300?u=6" referrerpolicy="no-referrer" class="image" width="42px" height="42px" /></div>
        <div class="">
          <h5 style="margin: 0px 8px; font-size: 14px;"><strong>Mariana Salas</strong></h5>
        </div>
      </div>
    </ion-item-divider>

    <ion-item lines="none" class="card-item">
      <ion-avatar slot="start" style="margin: 1px 8px 1px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" src="https://i.pravatar.cc/150?img=38" />
      </ion-avatar>
      <ion-label style="margin: 0px;">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">Alan Rivera</h5>
        <p style=" margin-bottom: 0px; font-size: 11px;">rivera.alan.3m@gmail.com</p>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
        Saldo: <span style="color: #14BD4D;">$30,203.00</span>
      </ion-label>
      <ion-icon style="margin: 0px;" name="ellipsis-vertical" slot="end" (click)="setOpenOpts(true)"></ion-icon>
    </ion-item>

    <div class="" style="display: flex; justify-content: center; text-align: center; width: 100%; margin-left: 16px;"><ion-icon name="ellipsis-vertical" color="medium" style="font-size: 14px;"></ion-icon></div>

    <ion-item lines="none" class="card-item">
      <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
      </ion-avatar>
      <ion-label style="margin: 0px;">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">Alan Rivera</h5>
        <p style=" margin-bottom: 0px; font-size: 11px;">rivera.alan.3m@gmail.com</p>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
        Saldo: <span style="color: #14BD4D;">$30,203.00</span>
      </ion-label>
      <ion-icon style="margin-left: 0px;" name="ellipsis-vertical" slot="end"></ion-icon>
    </ion-item>

    <div class="" style="display: flex; justify-content: center; text-align: center; width: 100%; margin-left: 16px;"><ion-icon name="ellipsis-vertical" color="medium" style="font-size: 14px;"></ion-icon></div>

    <ion-item lines="none" class="card-item">
      <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
      </ion-avatar>
      <ion-label style="margin: 0px;">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">Alan Rivera</h5>
        <p style=" margin-bottom: 0px; font-size: 11px;">rivera.alan.3m@gmail.com</p>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
        Saldo: <span style="color: #14BD4D;">$30,203.00</span>
      </ion-label>
      <ion-icon style="margin-left: 0px;" name="ellipsis-vertical" slot="end"></ion-icon>
    </ion-item>

  </ion-item-group>

  <ion-item-group>
    <ion-item-divider class="head-list">
      <div class="ion-no-padding" style="display: flex; align-items: center; justify-content: space-between;">
        <div style="padding: 5px;"><img src="https://i.pravatar.cc/300?u=n" referrerpolicy="no-referrer" class="image" width="42px" height="42px" /></div>
        <div class="">
          <h5 style="margin: 0px 8px; font-size: 14px;"><strong>Karla Pinedo</strong></h5>
        </div>
      </div>
    </ion-item-divider>

    <ion-item lines="none" class="card-item">
      <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
      </ion-avatar>
      <ion-label style="margin: 0px;">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">Alan Rivera</h5>
        <p style=" margin-bottom: 0px; font-size: 11px;">rivera.alan.3m@gmail.com</p>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
        Saldo: <span style="color: #14BD4D;">$30,203.00</span>
      </ion-label>
      <ion-icon style="margin-left: 0px;" name="ellipsis-vertical" slot="end"></ion-icon>
    </ion-item>

    <div class="" style="display: flex; justify-content: center; text-align: center; width: 100%; margin-left: 16px;"><ion-icon name="ellipsis-vertical" color="medium" style="font-size: 14px;"></ion-icon></div>

    <ion-item lines="none" class="card-item">
      <ion-avatar slot="start" style="margin: 4px 8px 4px 0px;" class="item-avatar">
        <img alt="Silhouette of a person's head" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
      </ion-avatar>
      <ion-label style="margin: 0px;">
        <h5 style="margin-bottom: 0px; font-size: 12px; font-weight: bold;">Alan Rivera</h5>
        <p style=" margin-bottom: 0px; font-size: 11px;">rivera.alan.3m@gmail.com</p>
      </ion-label>
      <ion-label style="font-size: 11px; text-align: center; font-weight: bold;">
        Saldo: <span style="color: #14BD4D;">$30,203.00</span>
      </ion-label>
      <ion-icon style="margin-left: 0px;" name="ellipsis-vertical" slot="end"></ion-icon>
    </ion-item>

  </ion-item-group> -->


  <!-- Modal to show information -->
  <!-- <ion-modal class="ion-modal-ases" [isOpen]="isModalOpenClient" (willDismiss)="isModalOpenClient=false"> -->
  <ion-modal [isOpen]="isModalOpenClient" (willDismiss)="isModalOpenClient=false">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar>
          <ion-icon size="large" style="margin-left: 16px;" (click)="isModalOpenClient = false" slot="start" name="arrow-back-outline"></ion-icon>
          <!-- <ion-buttons slot="end">
            <ion-button (click)="setOpenOpts(true, clienteModalInfo)"><ion-icon style="font-size: 24px;" name="ellipsis-vertical"></ion-icon></ion-button>
          </ion-buttons> -->

          <ion-icon slot="end" style="font-size: 24px; margin-right: 16px;" name="ellipsis-vertical" id="modal-show"></ion-icon>
          <ion-popover trigger="modal-show" side="left" alignment="start" [showBackdrop]="false" [dismissOnSelect]="true">
            <ng-template>
              <ion-content class="">
                <ion-list>
                  <ion-item [button]="true" [detail]="false" lines="none" *ngIf="dataUser.role === 'ADMINISTRADOR'" (click)="setOpenLongPress(true)">Asignar asesor</ion-item>
                  <ion-item [button]="true" [detail]="false" lines="none" (click)="setOpenAdd(true, 'ACTUALIZAR')">Editar usuario</ion-item>
                  <ion-item [button]="true" [detail]="false" lines="none" *ngIf="dataUser.role === 'ADMINISTRADOR'" (click)="presentActionSheet()">Eliminar</ion-item>
                </ion-list>
              </ion-content>
            </ng-template>
          </ion-popover>
        </ion-toolbar>
      </ion-header>
      <ion-content>

        <div class="ion-no-padding" style="display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 28px 16px 16px; ">
          <ion-avatar class="head-avatar">
            <img *ngIf="srcImageName(clienteModalInfo.evidencia_aval, 'foto-perfil') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="Cliente image" (click)="setZoomIn(image.url, image.originalname)" />
          </ion-avatar>
          <h5 style="margin: 14px 8px 0px 8px; font-size: 14px;"><strong>{{clienteModalInfo.nombre}}</strong></h5>
          <h4 style="margin: 8px 0px 0px 0px; font-size: 11px; font-weight: bold; color: gray;"><strong>{{clienteModalInfo.email}}</strong></h4>
        </div>

        <div class="ion-no-padding" style="display: flex; align-items: center; justify-content: space-around; padding: 8px 16px;">
          <div class="" style="display: flex; flex-direction: column;align-items: center;">
            <img src="../../assets/🦆 icon _chat_.svg" width="24px" height="24px" />
            <h4 style="margin: 10px 8px; font-size: 9px;"><strong>Mensaje texto</strong></h4>
          </div>
          <div class="" style="display: flex; flex-direction: column;align-items: center;">
            <img src="../../assets/🦆 icon _mail_.svg" width="24px" height="24px" />
            <h4 style="margin: 10px 8px; font-size: 9px;"><strong>Enviar correo</strong></h4>
          </div>
          <div class="" style="display: flex; flex-direction: column;align-items: center;" (click)="callNumber(clienteModalInfo?.telefono)">
            <img src="../../assets/🦆 icon _call_.svg" width="24px" height="24px" />
            <h4 style="margin: 10px 8px; font-size: 9px;"><strong>Hacer llamada</strong></h4>
          </div>
        </div>

        <div class="ion-no-padding" style="display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 8px 16px;">
          <div style="background-color: #0B5970; width: 85%; margin: 6px; border-radius: 10px; height: 35px; display: flex; align-items: center;">
            <img style="margin-left: 8px;" src="../../assets/🦆 icon _money send_ solid.svg" width="24px" height="24px" />
            <p style="margin: 0; margin-left: 14%; font-size: 12px; color: white;"><strong>Saldo:</strong> ${{clienteModalInfo.saldo}}.00 - <strong>MX</strong></p>
          </div>
          <div style="background-color: rgba(224, 224, 224, 0.46); width: 85%; margin: 6px; border-radius: 10px; height: 35px; display: flex; align-items: center;">
            <img style="margin-left: 8px;" src="../../assets/🦆 icon _trend down_.svg" width="24px" height="24px" />
            <p style="margin: 0; margin-left: 12%; font-size: 12px; color: black;"><strong>Pendiente:</strong> $11,000.00 - <strong>MX</strong></p>
          </div>
        </div>


        <ion-accordion-group [multiple]="true" [value]="accordionValueCliente">
          <ion-accordion value="first">
            <ion-item slot="header">
              <ion-label><p style="font-weight: bold;">Informacion general</p></ion-label>
            </ion-item>
            <div class="" slot="content">
              <ion-list style="padding: 10px 28px;">
                <ion-list-header class="ion-no-padding">
                  <ion-label>Cliente info:</ion-label>
                </ion-list-header>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Número telefónico:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">
                    {{clienteModalInfo.telefono}}</p>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Dirección:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">
                    {{clienteModalInfo.direccion}}</p>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;" *ngIf="clienteModalInfo.assigned_to">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Asesor asignado:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">{{clienteModalInfo.assigned_to}}</p>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Ubicación en el mapa:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">39.98.00.21
                    ; 87.22.86.09</p>
                </div>
              </ion-list>
              <ion-list style="padding: 10px 28px;">
                <ion-list-header class="ion-no-padding">
                  <ion-label>Aval info:</ion-label>
                </ion-list-header>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Nombre completo:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">
                    {{clienteModalInfo.aval_info?.nombre_aval}}</p>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Número telefónico:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">
                    {{clienteModalInfo.aval_info?.telefono_aval}}</p>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Correo electronico:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">
                    {{clienteModalInfo.aval_info?.email_aval}}</p>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 4px;">
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 0px;">Dirección:</p>
                  <p style="font-size: 12px; font-weight: bold; margin: 8px 0px 0px 8px; color: gray; text-align: right;">
                    {{clienteModalInfo.aval_info?.direccion_aval}}</p>
                </div>
              </ion-list>
            </div>
          </ion-accordion>
          <ion-accordion value="second">
            <ion-item slot="header">
              <!-- <ion-icon name="time-outline"></ion-icon> -->
              <ion-label><p style="font-weight: bold;">Evidencia</p></ion-label>
            </ion-item>
            <div class="ion-padding" slot="content">
              <ion-grid class="fotos-gallery ion-padding-vertical" style="padding-left: 0; padding-right: 0;">
                <ion-row class="ion-justify-content-start">
                  <ion-col size="1" class="ion-no-padding" style="padding: 1px; height: 120px;"
                    *ngFor="let img of clienteModalInfo?.evidencia_aval">
                    <img alt="Silhouette of mountains" [src]="img.url" style="width: 100%; height: 100%; object-fit: cover;" />
                    <ion-skeleton-text *ngIf="!img.url" [animated]="true"
                      style="width: 100%; height: 100%; object-fit: cover;"></ion-skeleton-text>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </div>
          </ion-accordion>
          <ion-accordion value="second-one">
            <ion-item slot="header">
              <!-- <ion-icon name="time-outline"></ion-icon> -->
              <ion-label><p style="font-weight: bold;">Garantias</p></ion-label>
            </ion-item>
            <div class="ion-padding" slot="content">
              <ion-grid class="fotos-gallery ion-padding-vertical" style="padding-left: 0; padding-right: 0;">
                <ion-row class="ion-justify-content-start">
                  <!-- <ion-col size="1" class="ion-no-padding" style="padding: 1px; height: 120px;"
                    *ngFor="let loc of images">
                    <img alt="Silhouette of mountains" [src]="loc.data" style="width: 100%; height: 100%; object-fit: cover;"
                      (click)="setZoomIn(loc.data, loc.name)" />
                  </ion-col> -->
                  <ion-col *ngIf="clienteModalInfo?.garantias.length <= 0" size="1" class="ion-no-padding" style="padding: 1px; height: 120px;">
                    <div class="bord-picture-user" (click)="setEvidencia('garantia')">
                      <ion-icon name="add-outline" size="large"></ion-icon>
                    </div>
                  </ion-col>
                  <ng-container *ngIf="clienteModalInfo?.garantias.length > 0">
                    <ion-col #photosDelete size="1" class="ion-no-padding" style="padding: 1px; height: 120px;" *ngFor="let gar of clienteModalInfo?.garantias; let i = index">
                      <img alt="Silhouette of mountains" [src]="gar.url" style="width: 100%; height: 100%; object-fit: cover;" (click)="setZoomIn(gar.url, gar.originalname)" />
                      <ion-checkbox 
                        *ngIf="selectPhotosActive"
                        style="position: absolute; inset-inline-end: 1px; margin: 8px; --size: 26px;"
                        [checked]="checkElementSelected(selectedPhotoForDelete,gar)"
                        (ionChange)="onPhotoCheckboxChange($event, gar)"
                      ></ion-checkbox>
                      <ion-skeleton-text *ngIf="!gar.url" [animated]="true" style="width: 100%; height: 100%; object-fit: cover;"></ion-skeleton-text>
                    </ion-col>
                    <div *ngIf="!selectPhotosActive" class="bord-picture-user" style="margin: 0px;" (click)="setEvidencia('garantia')">
                      <ion-icon name="add-outline" size="large"></ion-icon>
                    </div>
                  </ng-container>
                  <ion-item *ngIf="sendingGarantias" style="display: flex; justify-content: center; align-items: center;">
                    <ion-spinner></ion-spinner>
                  </ion-item>
                </ion-row>
              </ion-grid>
            </div>
          </ion-accordion>
          <ion-accordion value="third">
            <ion-item slot="header">
              <!-- <ion-icon name="time-outline"></ion-icon> -->
              <ion-label><p style="font-weight: bold;">Historial</p></ion-label>
            </ion-item>
            <div class="ion-padding" slot="content">
              <ion-item button detail="true" (click)="setOpenPresAtraz(true, 'prestamos')">
                <ion-icon slot="start" name="cash-outline"></ion-icon>
                <ion-label>Prestamos</ion-label>
                <ion-label slot="end" color="medium">{{clienteModalInfo.historial?.prestamos_detallados.length}}</ion-label>
              </ion-item>
              <ion-item button detail="true" (click)="setOpenPresAtraz(true, 'retrasos')">
                <ion-icon slot="start" name="hourglass-outline"></ion-icon>
                <ion-label>Retrasos</ion-label>
                <ion-label slot="end" color="medium">{{clienteModalInfo.historial?.detalles_retrasos.length}}</ion-label>
              </ion-item>
            </div>
          </ion-accordion>
          <ion-accordion value="fourth">
            <ion-item slot="header">
              <ion-label><p style="font-weight: bold;">Próximos pagos</p></ion-label>
            </ion-item>
            <div class="ion-padding" slot="content">
              <ion-item *ngFor="let p of clienteModalInfo.historial?.prestamos_detallados; let ip = index" [button]="true" detail="false" lines="none">
                <ng-container *ngIf="getProximoPago(p.detalles?.tabla_amortizacion) as lastPago">
                  <ion-label (click)="goToPrestamoPago(p.detalles?._id, lastPago.idx)">
                    <strong class="my-label-badge">
                      Prestamo: ${{p.detalles?.saldo | moneyTransform}}.00
                      <ion-badge style="margin-left: 10px; border-radius: 25px;"
                        [color]="lastPago.pago.estado_pago === 'No pagado' && lastPago.pago.multa.dia_retraso <= 0 ? 'light' : lastPago.pago.estado_pago === 'Pagado' ? 'success' : lastPago.pago.estado_pago === 'Pendiente' ? 'warning' : 'danger'">
                        {{lastPago.pago.estado_pago === 'No pagado' && lastPago.pago.multa.dia_retraso <= 0 ? 'abierto' : lastPago.pago.estado_pago==='Pagado' ? 'pagado' : lastPago.pago.estado_pago==='Pendiente' ? 'pendiente' : 'retrasado' }}
                      </ion-badge>
                    </strong>
                    <p color="medium" class="ion-text-wrap">
                      Pago actual: #{{lastPago.pago.num_pago}} | Fecha pago: {{lastPago.pago.fecha_pago | date: 'dd/MM/yyyy'}}
                    </p>
                    <ion-item lines="none" style="--ion-item-background: transparent;">
                      <ion-avatar slot="start" style="width: 25px; height: 25px;">
                        <img *ngIf="srcImageName(p.detalles?.id_asesor.evidencia_aval, 'foto-perfil') as image" alt="Silhouette of a person's head" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" />
                      </ion-avatar>
                      <ion-label class="ion-no-margin">
                        <p>Asesor: <span style="color: black; font-weight: bold;">{{p.detalles?.id_asesor.nombre}}</span></p>
                      </ion-label>
                    </ion-item>
                  </ion-label>
                </ng-container>
                <ion-icon slot="end" color="medium" name="chevron-forward"></ion-icon>
              </ion-item>
              <p *ngIf="clienteModalInfo.historial?.prestamos_detallados <= 0" style="text-align: center;"><ion-text color="medium">No hay prestamos activos</ion-text></p>
            </div>
          </ion-accordion>
        </ion-accordion-group>

      </ion-content>
      <ion-footer *ngIf="selectPhotosActive">
        <ion-toolbar>
          <ion-label style="font-weight: bold; margin-left: 15px;">Seleccionadas: {{selectedPhotoForDelete.length}}</ion-label>
          <ion-button slot="end" fill="clear" color="darkmain" (click)="cancelPhotoSelection()">Cancelar</ion-button>
          <ion-button slot="end" color="danger" [disabled]="selectedPhotoForDelete.length <= 0" (click)="deleteSelectedGarantias()">Eliminar</ion-button>
        </ion-toolbar>
      </ion-footer>
    </ng-template>
  </ion-modal>
  <ion-modal [isOpen]="presRetrModal" (willDismiss)="presRetrModal=false">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar>
          <!-- <ion-title>{{clienteModalInfo?.nombre}}</ion-title> -->
          <ion-buttons slot="start">
            <ion-button (click)="presRetrModal=false"><ion-icon size="large" style="margin-left: 16px;" name="arrow-back-outline"></ion-icon></ion-button>
          </ion-buttons>
          <!-- <ion-button color="light" shape="round" (click)="presRetrModal=false">
            <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
          </ion-button> -->
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">

        <h5 style="font-size: 28px; font-weight: bold; text-align: left; margin-top: 12px; margin-bottom: 22px;">{{isPrestOrRetrasos=='retrasos'? 'Retrasos' : 'Prestamos'}}</h5>

        <ng-container *ngIf="isPrestOrRetrasos==='prestamos'">
        <!-- <ion-item *ngFor="let p of clienteModalInfo.historial?.prestamos_detallados" [button]="true" lines="full">
          <ion-label>
            <p>Monto solicitado</p>
            <h3 style="font-weight: bold;">${{p.detalles?.saldo | moneyTransform}}.00</h3>
          </ion-label>
          <ion-icon name="swap-horizontal-outline"></ion-icon>
          <ion-label>
            <p style="text-align: end;">Monto pendiente</p>
            <h3 style="text-align: end; font-weight: bold;">${{p.saldo_pendiente | moneyTransform}}.00</h3>
          </ion-label>
        </ion-item> -->
        <ion-accordion-group>
          <ion-accordion *ngFor="let p of clienteModalInfo.historial?.prestamos_detallados" [value]="p.id_prestamo">
            <ion-item slot="header" [button]="true" lines="full"
              class="item-border">
              <ion-label>
                <p>Monto solicitado</p>
                <h3 style="font-weight: bold; margin-top: 10px;">${{p.detalles?.saldo | moneyTransform}}.00</h3>
              </ion-label>
              <ion-icon name="swap-horizontal-outline"></ion-icon>
              <ion-label>
                <p style="text-align: end;">Monto pendiente</p>
                <h3 style="text-align: end; font-weight: bold; margin-top: 10px;">${{p.saldo_pendiente | moneyTransform}}.00</h3>
              </ion-label>
            </ion-item>

            <div class="ion-padding" slot="content">
              <ion-item lines="none" class="no-left-padding">
                <ion-label>
                  <h5 style="font-size: 18px; font-weight: bold; text-align: left;">Detalle de Prestamo</h5>
                </ion-label>
                <p slot="end" color="medium" (click)="goToPrestamo(p.detalles?._id)"><u>Ver mas</u></p>
              </ion-item>
              <ion-item lines="none" class="my-info-pago ion-no-padding">
                <ion-label style="margin-bottom: 15px;">
                  <ion-chip style="margin-left: 0px;">
                    <ion-icon name="woman-outline"></ion-icon>
                    <ion-label>Asesor: {{p.detalles?.id_asesor.nombre}}</ion-label>
                  </ion-chip>
                  <div style="display: flex; align-items: center;">
                    <ion-icon slot="start" name="calendar"></ion-icon>
                    <p style="margin: 5px 0px 0px 10px"> {{p.detalles?.tipo_pago}} | {{p.detalles?.periodo}} pagos {{p.detalles.dia_pago? '| DP: ' + p.detalles?.dia_pago : ''}}</p>
                  </div>
                </ion-label>
              </ion-item>
              <ion-grid *ngIf="p.detalles?.tabla_amortizacion.length<=6">
                <ion-row>
                  <div class="horizontal-scroll-container">
                    <!-- Your horizontally scrolling content, e.g., ion-col elements -->
                    <ion-col *ngFor="let dp of p.detalles?.tabla_amortizacion; let i = index">
                      <div class="unread-indicator" *ngIf="dp.multa?.dia_retraso>0 && !dp.multa?.saldado"></div>
                      <ion-card [color]="selectedPagoIndex[p.id_prestamo] === i? 'darkmain' : 'light'"
                        (click)="selectPago(p.id_prestamo, i)">
                        <ion-card-header style="padding: 8px;">
                          <ion-card-title style="text-align: center; font-size: 15px; font-weight: bold;">{{dp.fecha_pago | date:
                            'dd'}}</ion-card-title>
                          <ion-note style="text-align: center; font-size: 12px;">{{dp.fecha_pago | date: 'MMM' |
                            uppercase}}</ion-note>
                        </ion-card-header>
                      </ion-card>
                    </ion-col>
                  </div>
                </ion-row>
                <div *ngIf="selectedPagoIndex[p.id_prestamo] !== undefined">
                  <ng-container *ngIf="p.detalles?.tabla_amortizacion[selectedPagoIndex[p.id_prestamo]] as pagoDetalle">
                    <ion-list style="margin: 16px 0px;" [inset]="true">
                      <ion-list-header class="ion-no-padding">
                        <ion-label color="dark">
                          <strong>Detalles de pago</strong>
                        </ion-label>
                      </ion-list-header>
                      <ion-item class="no-left-padding">
                        <ion-label class="custom-item">
                          <ion-badge slot="start" color="darkmain">NUMERO DE PAGO: {{selectedPagoIndex[p.id_prestamo]+1}}</ion-badge>
                          <strong>{{pagoDetalle.estado_pago}}</strong>
                          <ion-text style="margin: 10px 0px;">Multas ${{pagoDetalle.multa?.monto_pendiente | moneyTransform }} • {{pagoDetalle.multa?.dia_retraso || 0}} dias de retraso</ion-text><br />
                          <ion-note color="medium" class="ion-text-wrap">{{pagoDetalle.notas? pagoDetalle.notas : 'No hay notas sobre este pago' }}</ion-note>
                        </ion-label>
                        <div class="metadata-end-wrapper" slot="end">
                          <ion-note color="medium">Monto: ${{pagoDetalle.cuota | moneyTransform}}.00</ion-note>
                        </div>
                      </ion-item>
                      <ion-button color="darkmain" expand="block" fill="outline" (click)="goToPrestamoPago(p.id_prestamo, selectedPagoIndex[p.id_prestamo])">Revisar pago</ion-button>
                    </ion-list>
                  </ng-container>
                </div>
              </ion-grid>
              <ion-grid class="pagos-calendar" *ngIf="p.detalles?.tabla_amortizacion.length>6">
                <ion-row>
                  <ion-col size="1" class="ion-no-padding" *ngFor="let dp of p.detalles?.tabla_amortizacion; let i = index">
                    <div class="unread-indicator" *ngIf="dp.multa?.dia_retraso>0 && !dp.multa?.saldado"></div>
                    <ion-card [color]="selectedPagoIndex[p.id_prestamo] === i? 'darkmain' : 'light'" (click)="selectPago(p.id_prestamo, i)" style="border-radius: 8px;">
                      <ion-card-header style="padding: 8px;">
                        <ion-card-title style="text-align: center; font-size: 15px; font-weight: bold;">{{dp.fecha_pago | date: 'dd'}}</ion-card-title>
                        <ion-note style="text-align: center; font-size: 12px;">{{dp.fecha_pago | date: 'MMM' | uppercase}}</ion-note>
                      </ion-card-header>
                    </ion-card>
                  </ion-col>
                </ion-row>
                <div *ngIf="selectedPagoIndex[p.id_prestamo] !== undefined">
                  <ng-container *ngIf="p.detalles?.tabla_amortizacion[selectedPagoIndex[p.id_prestamo]] as pagoDetalle">
                    <ion-list style="margin: 16px 0px;" [inset]="true">
                      <ion-list-header class="ion-no-padding">
                        <ion-label>
                          <h2>Detalles de pago</h2>
                        </ion-label>
                      </ion-list-header>
                      <ion-item class="no-left-padding">
                        <ion-label class="custom-item">
                          <ion-badge slot="start" color="darkmain">NUMERO DE PAGO: {{selectedPagoIndex[p.id_prestamo]+1}}</ion-badge>
                          <strong>{{pagoDetalle.estado_pago}}</strong>
                          <ion-text style="margin: 10px 0px;" *ngIf="pagoDetalle.multa?.monto_pendiente == 0">Abierto</ion-text><br />
                          <ion-text style="margin: 10px 0px;" *ngIf="pagoDetalle.multa?.monto_pendiente">Multas ${{pagoDetalle.multa?.monto_pendiente | moneyTransform }} • {{pagoDetalle.multa?.dia_retraso || 0}} dias de retraso</ion-text><br />
                          <ion-note color="medium" class="ion-text-wrap">
                            {{pagoDetalle.notas? pagoDetalle.notas : 'No hay notas sobre este pago' }}
                          </ion-note>
                        </ion-label>
                        <div class="metadata-end-wrapper" slot="end">
                          <ion-note color="medium">Monto: </ion-note> <ion-badge slot="start" color="darkmain">${{pagoDetalle.cuota | moneyTransform}}.00</ion-badge>
                        </div>
                      </ion-item>
                      <ion-button color="darkmain" expand="block" fill="outline" (click)="goToPrestamoPago(p.id_prestamo, selectedPagoIndex[p.id_prestamo])">Revisar pago {{selectedPagoIndex[p.id_prestamo]+1}}</ion-button>
                    </ion-list>
                  </ng-container>
                </div>
              </ion-grid>
            </div>
          </ion-accordion>
        </ion-accordion-group>
        <!-- <ion-item *ngFor="let p of clienteModalInfo.historial?.prestamos_detallados" [button]="true" lines="full" class="item-border">
          <ion-label>
            <p>Monto solicitado</p>
            <h3 style="font-weight: bold; margin-top: 10px;">${{p.detalles?.saldo | moneyTransform}}.00</h3>
          </ion-label>
          <ion-icon name="swap-horizontal-outline"></ion-icon>
          <ion-label>
            <p style="text-align: end;">Monto pendiente</p>
            <h3 style="text-align: end; font-weight: bold; margin-top: 10px;">${{p.saldo_pendiente | moneyTransform}}.00</h3>
          </ion-label>
        </ion-item> -->
        <ion-text color="medium" *ngIf="clienteModalInfo.historial?.prestamos_detallados.length<=0">
          <h4 style="text-align: center; margin: 85px 0px;">No se han asignado prestamos a este cliente</h4>
        </ion-text>
        <div style="padding: 16px;" *ngIf="clienteModalInfo.historial?.prestamos_detallados.length>0">
          <ion-button shape="round" expand="block" fill="clear" color="darkmain" size="small" (click)="goToPrestamosCli(clienteModalInfo)">Crear
            prestamo</ion-button>
        </div>
        </ng-container>

        <ng-container *ngIf="isPrestOrRetrasos==='retrasos'">
        <ion-accordion-group>
          <ion-accordion *ngFor="let grupo of getRetrasosAgrupados() | keyvalue">
            <ion-item slot="header" class="item-border-danger">
              <ion-label>
                <strong>Préstamo:</strong> {{grupo.value[0]?.monto_prestamo | moneyTransform}}.00
                <span slot="end" style="margin-left: 10px; color: gray;">({{grupo.value.length}} retraso{{grupo.value.length > 1 ? 's' :
                  ''}})</span>
              </ion-label>
            </ion-item>
            <div class="ion-padding" slot="content">
              <ion-list style="text-align: center;">
                <ion-list-header class="ion-no-padding">
                  <ion-label><p><strong>Numero de pago</strong></p></ion-label>
                  <ion-label><p><strong>Fecha de retraso</strong></p></ion-label>
                </ion-list-header>
                <ion-item *ngFor="let retraso of grupo.value" style="text-align: center;">
                  <ion-label>
                    <p>Pago #{{retraso.num_pago}}</p>
                  </ion-label>
                  <ion-label>
                    <p>{{retraso.fecha_retraso | date:'dd/MM/yyyy'}}</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
        </ion-accordion-group>
        <ion-text color="medium" *ngIf="clienteModalInfo.historial?.detalles_retrasos.length<=0">
          <h4 style="text-align: center; margin: 85px 0px;">No hay retrasos</h4>
        </ion-text>
        </ng-container>
      </ion-content>
      <div class="footerlog" *ngIf="clienteModalInfo.historial?.prestamos_detallados.length==0 && isPrestOrRetrasos==='prestamos'">
        <ion-button shape="round" expand="block" color="darkmain" (click)="goToPrestamosCli(clienteModalInfo)">Crear prestamo</ion-button>
      </div>
    </ng-template>
  </ion-modal>


  <!-- Modal to add a new Cliente -->
  <!-- <ion-modal [isOpen]="isModalOpenAdd" >
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button size="small" style="color: gray;" [strong]="true" (click)="setOpenAdd(false,rollModal)">Cancelar</ion-button>
          </ion-buttons>
          <h5 style="text-align: center; font-size: 16px; font-weight: bold;">Nuevo Cliente</h5>
          <ion-buttons slot="end">
            <ion-button size="small" style="color: rgba(147, 191, 207, 1);" [strong]="true">{{rollModal}}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>

        <section class="ion-padding">
          <h5 style="font-size: 12px; font-weight: bold; margin:16px,0px; color:gray; text-align: center;">Foto del cliente</h5>
          <div class="ion-activatable ripple-parent rectangle"
            style="border-radius: 8px; border: 2px solid #CACACA; border-style: dashed; height: 120px; width: 120px; margin: auto; margin-bottom: 12px; display: flex; justify-content: center; align-items: center;">
            <ion-icon style="font-size: 24px; color: #CACACA;" name="camera-outline"></ion-icon> <ion-icon
              style="font-size: 24px; color: #CACACA;" name="image-outline"></ion-icon>
            <ion-ripple-effect></ion-ripple-effect>
          </div>
          <div style="padding-top: 6%;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Nombre del cliente</h5>
            <div class="ion-no-margin"><input class="input-form" type="text"
              placeholder="Ingresa un nombre"></div>
          </div>
          <div style="padding-top: 4%;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Teléfono</h5>
            <div class="ion-no-margin"><input class="input-form" type="text"
                placeholder="Ingresa un número de teléfono"></div>
          </div>
          <div style="padding-top: 4%;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Correo del cliente</h5>
            <div class="ion-no-margin"><input class="input-form" type="text"
                placeholder="Ingresa el correo electrónico"></div>
          </div>
          <div style="padding-top: 4%;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Dirección del cliente</h5>
            <div class="ion-no-margin input-form" style="display: flex; align-items: center;">
              <input class="input-form-map" style="width: 90%;" type="text" placeholder="Ingresa una ubicación">
              <img style="display: flex;" src="../../assets/🦆 icon _map_.svg" alt="" width="22px" height="22px">
            </div>
          </div>
          <h5 style="font-size: 12px; font-weight: bold; margin:16px,0px; color:gray;">Evidencia del cliente</h5>
        </section>

        <section style="display: flex; justify-content: space-around; margin: 0px 8px;">
          <div class="ion-activatable ripple-parent rectangle" style="border-radius: 8px; border: 2px solid #CACACA; border-style: dashed; height: 85px; width: 45%; margin:0px; display: flex; justify-content: center; align-items: center;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;">Identificación Oficial Frontal</h5>
            <ion-ripple-effect></ion-ripple-effect>
          </div>
          <div class="ion-activatable ripple-parent rectangle" style="border-radius: 8px; border: 2px solid #CACACA; border-style: dashed; height: 85px; width: 45%; margin:0px; display: flex; justify-content: center; align-items: center;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;">Identificación Oficial Trasera</h5>
            <ion-ripple-effect></ion-ripple-effect>
          </div>
        </section>

        <section style="display: flex; justify-content: space-around; margin: 16px 8px;">
          <div class="ion-activatable ripple-parent rectangle" style="border-radius: 8px; border: 2px solid #CACACA; border-style: dashed; height: 120px; width: 95%; margin:0px; display: flex; justify-content: center; align-items: center;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;">Comprobante de <br> domicilio</h5>
            <ion-ripple-effect></ion-ripple-effect>
          </div>
        </section>

        <section style="display: flex; justify-content: space-around; margin: 16px 8px;">
          <div class="ion-activatable ripple-parent rectangle" style="border-radius: 8px; border: 2px solid #CACACA; border-style: dashed; height: 120px; width: 95%; margin:0px; display: flex; justify-content: center; align-items: center;">
            <h5 style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;">Comprobante de <br> cumplimiento aval</h5>
            <ion-ripple-effect></ion-ripple-effect>
          </div>
        </section>

      </ion-content>
    </ng-template>
  </ion-modal> -->
  <ion-modal [isOpen]="isModalOpenAdd" (didDismiss)="accordionValues=['first']">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-buttons slot="start">
              <ion-button size="small" style="color: gray;" [strong]="true" (click)="cancelarSubmit()" [disabled]="postingCliente">Cancelar</ion-button>
            </ion-buttons>
            <h5 style="text-align: center; font-size: 16px; font-weight: bold;">{{rollModal==='AGREGAR'? 'Nuevo Cliente' : 'Editar Cliente'}}</h5>
            <ion-buttons slot="end">
              <ion-button size="small" style="color: rgba(147, 191, 207, 1);" [strong]="true" (click)="submitAddCliente()" [disabled]="postingCliente">{{rollModal}}</ion-button>
            </ion-buttons>
            <ion-progress-bar *ngIf="postingCliente" type="indeterminate" color="darkmain"></ion-progress-bar>
          </ion-toolbar>
        </ion-header>
        <ion-content>
          <ion-accordion-group [multiple]="true" [value]="['first']" (ionChange)="accordionGroupChange($event)">
            <ion-accordion value="first">
              <ion-item slot="header" color="darkmain">
                <ion-icon *ngIf="!accordionValues.includes('first')" slot="end" name="add-outline" color="light"></ion-icon>
                <ion-icon *ngIf="accordionValues.includes('first')" slot="end" name="remove-outline" color="light"></ion-icon>
                <ion-label slot="start"><p>Informacion Cliente</p></ion-label>
              </ion-item>
              <div slot="content">
                <form [formGroup]="formInputPOST" #formDirective="ngForm">
                  <section class="ion-padding">
                    <!-- Pick file or take photo -->
                    <h5 *ngIf="!getImageByName('foto-perfil') && !srcImageName(clienteModalInfo?.evidencia_aval, 'foto-perfil')" style="font-size: 12px; font-weight: bold; margin:16px,0px; color:gray; text-align: center;">Foto del
                      cliente</h5>
                    <div class="ion-activatable ripple-parent rectangle bord-picture-user" (click)="setEvidencia('foto-perfil')"
                      [ngClass]="formSubmit && !getImageByName('foto-perfil') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'" [class.disabled]="postingCliente">
                      <ion-icon style="font-size: 24px; color: #CACACA;" name="camera-outline"></ion-icon> <ion-icon
                        style="font-size: 24px; color: #CACACA;" name="image-outline"></ion-icon>
                      <ion-ripple-effect></ion-ripple-effect>
                      <ng-container *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'foto-perfil') as image">
                        <img *ngIf="image && !getImageByName('foto-perfil')"
                          [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                      </ng-container>
                      <img class="imagen-ajustada" *ngIf="getImageByName('foto-perfil') as image" [src]="image.data"
                        alt="Imagen">
                      <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                        *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'foto-perfil')"><ion-icon slot="icon-only" size="small"
                          name="brush"></ion-icon></ion-button>
                    </div>
                    <!-- First part of formular -->
                    <div style="padding-top: 6%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Nombre del
                        cliente</h5>
                      <div class="ion-no-margin"><input class="input-form" type="text" formControlName="nombre"
                          placeholder="Ingresa un nombre" [readonly]="postingCliente"></div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('nombre')?.status == 'INVALID'">Ingresa
                        nombre</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Teléfono</h5>
                      <div class="ion-no-margin"><input class="input-form" type="number"
                          placeholder="Ingresa un número de teléfono" formControlName="telefono"
                          [readonly]="postingCliente"></div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('telefono')?.status == 'INVALID'">Ingresa un
                        telefono</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Correo del
                        cliente</h5>
                      <div class="ion-no-margin"><input class="input-form" type="email"
                          placeholder="Ingresa el correo electrónico" formControlName="email" [readonly]="postingCliente">
                      </div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('email')?.status == 'INVALID'">Ingresa correo
                        valido</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">CURP (ID)</h5>
                      <div class="ion-no-margin"><input class="input-form" type="text"
                          placeholder="Ingresa el correo electrónico" formControlName="curp" [readonly]="postingCliente">
                      </div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('curp')?.status == 'INVALID'">Ingresa el identificador
                        unico</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Dirección del
                        cliente</h5>
                      <div class="ion-no-margin input-form" style="display: flex; align-items: center;">
                        <input class="input-form-map" style="width: 90%;" type="text" placeholder="Ingresa una ubicación"
                          formControlName="direccion" [readonly]="postingCliente">
                        <img style="display: flex;" src="../../assets/🦆 icon _map_.svg" alt="" width="22px" height="22px">
                      </div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('direccion')?.status == 'INVALID'">Ingresa
                        direccion</small>
                    </div>
                    <h5 style="font-size: 12px; font-weight: bold; margin:16px,0px; color:gray;">Evidencia del cliente</h5>
                  </section>
                </form>

                <section style="display: flex; justify-content: space-around; margin: 0px 8px;">
                  <div class="ion-activatable ripple-parent rectangle bord-INE" (click)="setEvidencia('INE-front')"
                    [ngClass]="formSubmit && !getImageByName('INE-front') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'" [class.disabled]="postingCliente">
                    <h5 *ngIf="!getImageByName('INE-front') && !srcImageName(clienteModalInfo?.evidencia_aval, 'INE-front')" style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;"
                      >Identificación Oficial Frontal</h5>
                    <ion-ripple-effect></ion-ripple-effect>
                    <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'INE-front') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                    <ng-container *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'INE-front') as image">
                      <img *ngIf="image && !getImageByName('INE-front')"
                        [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                    </ng-container>
                    <img class="imagen-ajustada" *ngIf="getImageByName('INE-front') as image" [src]="image.data"
                      alt="">
                    <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                      *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'INE-front')"><ion-icon slot="icon-only" size="small"
                      name="brush"></ion-icon>
                    </ion-button>
                  </div>
                  <div class="ion-activatable ripple-parent rectangle bord-INE" (click)="setEvidencia('INE-back')"
                    [ngClass]="formSubmit && !getImageByName('INE-back') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'" [class.disabled]="postingCliente">
                    <h5 *ngIf="!getImageByName('INE-back') && !srcImageName(clienteModalInfo?.evidencia_aval, 'INE-back')" style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;"
                      >Identificación Oficial Trasera</h5>
                    <ion-ripple-effect></ion-ripple-effect>
                    <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'INE-back') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                    <ng-container *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'INE-back') as image">
                      <img *ngIf="image && !getImageByName('INE-back')"
                        [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                    </ng-container>
                    <img class="imagen-ajustada" *ngIf="getImageByName('INE-back') as image" [src]="image.data" alt="">
                    <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                      *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'INE-back')"><ion-icon slot="icon-only" size="small"
                      name="brush"></ion-icon>
                    </ion-button>
                  </div>
                </section>

                <section style="display: flex; justify-content: space-around; margin: 16px 8px;">
                  <div class="ion-activatable ripple-parent rectangle bord-domicilio" (click)="setEvidencia('com-domicilio')"
                    [ngClass]="formSubmit && !getImageByName('com-domicilio') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'" [class.disabled]="postingCliente">
                    <h5 *ngIf="!getImageByName('com-domicilio') && !srcImageName(clienteModalInfo?.evidencia_aval, 'com-domicilio')" style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;"
                      >Comprobante de <br> domicilio</h5>
                    <ion-ripple-effect></ion-ripple-effect>
                    <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'com-domicilio') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                    <ng-container *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'com-domicilio') as image">
                      <img *ngIf="image && !getImageByName('com-domicilio')"
                        [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                    </ng-container>
                    <img class="imagen-ajustada" *ngIf="getImageByName('com-domicilio') as image"
                      [src]="image.data" alt="">
                    <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                      *ngIf="srcImageName(clienteModalInfo?.evidencia_aval, 'com-domicilio')"><ion-icon slot="icon-only" size="small"
                      name="brush"></ion-icon>
                    </ion-button>
                  </div>
                </section>
              </div>
            </ion-accordion>
            <ion-accordion value="second">
              <ion-item slot="header" color="darkmain">
                <ion-icon *ngIf="!accordionValues.includes('second')" slot="end" name="add-outline" color="light"></ion-icon>
                <ion-icon *ngIf="accordionValues.includes('second')" slot="end" name="remove-outline" color="light"></ion-icon>
                <ion-label slot="start"><p>Informacion Aval</p></ion-label>
              </ion-item>
              <div slot="content">
                <form [formGroup]="formInputPOST" #formDirective="ngForm">
                  <section class="ion-padding">
                    <!-- Pick file or take photo -->
                    <h5 *ngIf="!srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'foto-perfil-aval')" style="font-size: 12px; font-weight: bold; margin:16px,0px; color:gray; text-align: center;">Foto aval</h5>
                    <div class="ion-activatable ripple-parent rectangle bord-picture-user" (click)="setEvidencia('foto-perfil-aval')"
                      [ngClass]="formSubmit && !getImageByName('foto-perfil-aval') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'">
                      <ion-icon *ngIf="!srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'foto-perfil-aval')" style="font-size: 24px; color: #CACACA;" name="camera-outline"></ion-icon> <ion-icon *ngIf="!srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'foto-perfil-aval')"
                        style="font-size: 24px; color: #CACACA;" name="image-outline"></ion-icon>
                      <ion-ripple-effect></ion-ripple-effect>
                      <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'foto-perfil-aval') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                      <ng-container *ngIf="srcImageName(clienteModalInfo?.aval_info?.evidencia_aval, 'foto-perfil-aval') as image">
                        <img *ngIf="image && !getImageByName('foto-perfil-aval')"
                          [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                      </ng-container>
                      <img class="imagen-ajustada" *ngIf="getImageByName('foto-perfil-aval') as image" [src]="image.data"
                        alt="">
                      <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                        *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'foto-perfil-aval')"><ion-icon slot="icon-only" size="small"
                          name="brush"></ion-icon>
                      </ion-button>
                    </div>
                    <!-- First part of formular -->
                    <div style="padding-top: 6%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Nombre aval</h5>
                      <div class="ion-no-margin"><input class="input-form" type="text" formControlName="nombre_aval"
                          placeholder="Ingresa un nombre"></div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('nombre_aval')?.status == 'INVALID'">Ingresa
                        nombre</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Teléfono</h5>
                      <div class="ion-no-margin"><input class="input-form" type="number"
                          placeholder="Ingresa un número de teléfono" formControlName="telefono_aval"></div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('telefono_aval')?.status == 'INVALID'">Ingresa un
                        telefono</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Correo de aval</h5>
                      <div class="ion-no-margin"><input class="input-form" type="email"
                          placeholder="Ingresa el correo electrónico" formControlName="email_aval">
                      </div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('email_aval')?.status == 'INVALID'">Ingresa correo
                        valido</small>
                    </div>
                    <div style="padding-top: 4%;">
                      <h5 style="font-size: 12px; font-weight: bold; margin:0px; padding-bottom: 6px; color:gray;">Dirección aval</h5>
                      <div class="ion-no-margin input-form" style="display: flex; align-items: center;">
                        <input class="input-form-map" style="width: 90%;" type="text" placeholder="Ingresa una ubicación"
                          formControlName="direccion_aval">
                        <img style="display: flex;" src="../../assets/🦆 icon _map_.svg" alt="" width="22px" height="22px">
                      </div>
                      <small class="invalid" *ngIf="formSubmit && formInputPOST.get('direccion_aval')?.status == 'INVALID'">Ingresa
                        direccion</small>
                    </div>
                    <h5 style="font-size: 12px; font-weight: bold; margin:16px,0px; color:gray;">Evidencia aval</h5>
                  </section>
                </form>

                <section style="display: flex; justify-content: space-around; margin: 0px 8px;">
                  <div class="ion-activatable ripple-parent rectangle bord-INE" (click)="setEvidencia('INE-front-aval')"
                    [ngClass]="formSubmit && !getImageByName('INE-front-aval') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'">
                    <h5 *ngIf="!getImageByName('INE-front-aval') && !srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'INE-front-aval')" style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;"
                    >Identificación Oficial Frontal</h5>
                    <ion-ripple-effect></ion-ripple-effect>
                    <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'INE-front-aval') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                    <ng-container *ngIf="srcImageName(clienteModalInfo?.aval_info?.evidencia_aval, 'INE-front-aval') as image">
                      <img *ngIf="image && !getImageByName('INE-front-aval')"
                        [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                    </ng-container>
                    <img class="imagen-ajustada" *ngIf="getImageByName('INE-front-aval') as image" [src]="image.data"
                      alt="">
                    <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                      *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'INE-front-aval')"><ion-icon slot="icon-only" size="small"
                        name="brush"></ion-icon>
                    </ion-button>
                  </div>
                  <div class="ion-activatable ripple-parent rectangle bord-INE" (click)="setEvidencia('INE-back-aval')"
                    [ngClass]="formSubmit && !getImageByName('INE-back-aval') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'">
                    <h5 *ngIf="!getImageByName('INE-back-aval') && !srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'INE-back-aval')" style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;"
                    >Identificación Oficial Trasera</h5>
                    <ion-ripple-effect></ion-ripple-effect>
                    <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'INE-back-aval') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                    <ng-container *ngIf="srcImageName(clienteModalInfo?.aval_info?.evidencia_aval, 'INE-back-aval') as image">
                      <img *ngIf="image && !getImageByName('INE-back-aval')" style="width: 100%;"
                        [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                    </ng-container>
                    <img class="imagen-ajustada" *ngIf="getImageByName('INE-back-aval') as image" [src]="image.data" alt="">
                    <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                      *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'INE-back-aval')"><ion-icon slot="icon-only" size="small"
                        name="brush"></ion-icon>
                    </ion-button>
                  </div>
                </section>

                <section style="display: flex; justify-content: space-around; margin: 16px 8px;">
                  <div class="ion-activatable ripple-parent rectangle bord-domicilio" (click)="setEvidencia('com-domicilio-aval')"
                    [ngClass]="formSubmit && !getImageByName('com-domicilio-aval') && rollModal != 'ACTUALIZAR' ? 'bord-picture-invalid' : 'hide'">
                    <h5 *ngIf="!getImageByName('com-domicilio-aval') && !srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'com-domicilio-aval')" style="font-size: 12px; font-weight: bold; margin:0px 24px; color:#CACACA; text-align: center;"> Comprobante de <br> domicilio</h5>
                    <ion-ripple-effect></ion-ripple-effect>
                    <!-- <img style="height: 100%; width: 100%;" *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'com-domicilio-aval') as image" [src]="image.url? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt=""> -->
                    <ng-container *ngIf="srcImageName(clienteModalInfo?.aval_info?.evidencia_aval, 'com-domicilio-aval') as image">
                      <img *ngIf="image && !getImageByName('com-domicilio-aval')"
                        [src]="image.url ? image.url : 'https://ionicframework.com/docs/img/demos/avatar.svg'" alt="">
                    </ng-container>
                    <img class="imagen-ajustada" *ngIf="getImageByName('com-domicilio-aval') as image"
                      [src]="image.data" alt="">
                    <ion-button class="small" size="small" style="position: absolute; bottom: 0; right: 0;"
                      *ngIf="srcImageName(clienteModalInfo.aval_info?.evidencia_aval, 'com-domicilio-aval')"><ion-icon slot="icon-only" size="small"
                        name="brush"></ion-icon>
                    </ion-button>
                  </div>
                </section>
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </ion-content>
      </ng-template>
  </ion-modal>
  <!-- Modal to show options of item -->
  <ion-modal [isOpen]="isModalOpenOptns" [initialBreakpoint]="1" [breakpoints]="[0, 1]" class="ion-modal-opts" (willDismiss)="isModalOpenOptns=false">
    <ng-template>
      <div class="block">
        <ion-button fill="clear" expand="block" (click)="setOpenAdd(true,'ACTUALIZAR')" (click)="isModalOpenOptns=false">
          <ion-icon name="create" slot="start" style="color: gray;"></ion-icon>
          <h5 style="font-size: 14px; text-transform: initial; color: gray;">Editar cliente</h5>
        </ion-button>
        <ion-button fill="clear" (click)="presentActionSheet()">
          <ion-icon name="trash" slot="start" style="color: gray;"></ion-icon>
          <h5 style="font-size: 14px; text-transform: initial; color: gray;">Eliminar cliente</h5>
        </ion-button>
      </div>
    </ng-template>
  </ion-modal>
  <!-- Modal to select picture or take one -->
    <ion-modal
      [isOpen]="isModalOpenPicture"
      [initialBreakpoint]="0.18"
      [breakpoints]="[0, 0.18]"
      (willDismiss)="isModalOpenPicture=false">
      <ng-template>
        <div class="block">
          <ion-button fill="clear" expand="block" *ngIf="!getImageByName(rollMedia) && rollMedia !='garantia'" (click)="takePicture(rollMedia)">
            <ion-icon name="camera-outline" slot="start" style="color: gray;"></ion-icon>
            <h5 style="font-size: 14px; text-transform: initial; color: gray;">Tomar Foto</h5>
          </ion-button>
          <ion-button fill="clear" *ngIf="!getImageByName(rollMedia) && rollMedia !='garantia'" (click)="selectPicture(rollMedia)">
            <ion-icon name="image-outline" slot="start" style="color: gray;"></ion-icon>
            <h5 style="font-size: 14px; text-transform: initial; color: gray;">Elegir foto</h5>
          </ion-button>
          <ion-button fill="clear" *ngIf="rollMedia==='garantia'" (click)="pickPicture(rollMedia)">
            <ion-icon name="image-outline" slot="start" style="color: gray;"></ion-icon>
            <h5 style="font-size: 14px; text-transform: initial; color: gray;">Multiples fotos</h5>
          </ion-button>
          <ng-container *ngIf="getImageByName(rollMedia) as image">
            <ion-button *ngIf="rollMedia !== 'garantia'" fill="clear" (click)="deletePicture(image)">
              <ion-icon name="trash" slot="start" style="color: red;"></ion-icon>
              <h5 style="font-size: 14px; text-transform: initial; color: red;">Quitar imagen</h5>
            </ion-button>
          </ng-container>
        </div>
      </ng-template>
    </ion-modal>

  <!-- Modal for Zoom -->
  <ion-modal [isOpen]="toZoom" class="zoom">
    <ng-template>
      <ion-header class="ion-no-border">
        <ion-toolbar>
          <ion-title>{{zoomImageName}}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="dismissZoom()">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <div class="swiper-center-wrapper">
          <swiper-container zoom-max-ratio="3" zoom-min-ratio="1" thumbs-swiper=".mySwiper2" space-between="10"
            navigation="true">
            <swiper-slide>
              <div class="swiper-zoom-container">
                <img [src]="zoomImageUrl" />
              </div>
            </swiper-slide>
          </swiper-container>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>


  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="setOpenAdd(true,'AGREGAR')">
      <ion-icon size="large" name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
